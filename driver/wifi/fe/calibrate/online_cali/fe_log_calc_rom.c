/*
 * Copyright (c) CompanyNameMagicTag 2022-2022. All rights reserved.
 * Description: log计算相关的查表
 * Create: 2022-11-09
 */

#include "fe_log_calc_rom.h"
#include "wlan_util_common_rom.h"
#include "wlan_types.h"

#ifdef __cplusplus
#if __cplusplus
extern "C" {
#endif
#endif

/*
 * 20log查询表 单位0.01dbm
 */
const osal_s16 g_fe_20log_table[] = {
	/* 0  ~15  */
    0, 0, 602, 954, 1204, 1398, 1556, 1690, 1806, 1908, 2000, 2083, 2158, 2228, 2292, 2352,
	/* 16 ~30  */
    2408, 2461, 2511, 2558, 2602, 2644, 2685, 2723, 2760, 2796, 2830, 2863, 2894, 2925, 2954,
	/* 31 ~45  */
    2983, 3010, 3037, 3063, 3088, 3113, 3136, 3160, 3182, 3204, 3226, 3246, 3267, 3287, 3306,
	/* 46 ~60  */
    3326, 3344, 3362, 3380, 3398, 3415, 3432, 3449, 3465, 3481, 3496, 3512, 3527, 3542, 3556,
	/* 61 ~75  */
    3571, 3585, 3599, 3612, 3626, 3639, 3652, 3665, 3678, 3690, 3703, 3715, 3727, 3738, 3750,
	/* 76 ~90  */
    3762, 3773, 3784, 3795, 3806, 3817, 3828, 3838, 3849, 3859, 3869, 3879, 3889, 3899, 3908,
	/* 91 ~105 */
    3918, 3928, 3937, 3946, 3955, 3965, 3974, 3982, 3991, 4000, 4009, 4017, 4026, 4034, 4042,
	/* 106~120 */
    4051, 4059, 4067, 4075, 4083, 4091, 4098, 4106, 4114, 4121, 4129, 4136, 4144, 4151, 4158,
	/* 121~135 */
    4166, 4173, 4180, 4187, 4194, 4201, 4208, 4214, 4221, 4228, 4235, 4241, 4248, 4254, 4261,
	/* 136~150 */
    4267, 4273, 4280, 4286, 4292, 4298, 4305, 4311, 4317, 4323, 4329, 4335, 4341, 4346, 4352,
	/* 151~165 */
    4358, 4364, 4369, 4375, 4381, 4386, 4392, 4397, 4403, 4408, 4414, 4419, 4424, 4430, 4435,
	/* 166~180 */
    4440, 4445, 4451, 4456, 4461, 4466, 4471, 4476, 4481, 4486, 4491, 4496, 4501, 4506, 4511,
	/* 181~195 */
    4515, 4520, 4525, 4530, 4534, 4539, 4544, 4548, 4553, 4558, 4562, 4567, 4571, 4576, 4580,
	/* 196~210 */
    4585, 4589, 4593, 4598, 4602, 4606, 4611, 4615, 4619, 4624, 4628, 4632, 4636, 4640, 4644,
	/* 211~225 */
    4649, 4653, 4657, 4661, 4665, 4669, 4673, 4677, 4681, 4685, 4689, 4693, 4697, 4700, 4704,
	/* 226~240 */
    4708, 4712, 4716, 4720, 4723, 4727, 4731, 4735, 4738, 4742, 4746, 4749, 4753, 4757, 4760,
	/* 241~255 */
    4764, 4768, 4771, 4775, 4778, 4782, 4785, 4789, 4792, 4796, 4799, 4803, 4806, 4810, 4813,
	/* 256 ~270 */
    4816, 4820, 4823, 4827, 4830, 4833, 4837, 4840, 4843, 4846, 4850, 4853, 4856, 4860, 4863,
	/* 271 ~285 */
    4866, 4869, 4872, 4876, 4879, 4882, 4885, 4888, 4891, 4894, 4897, 4900, 4904, 4907, 4910,
	/* 286 ~300 */
    4913, 4916, 4919, 4922, 4925, 4928, 4931, 4934, 4937, 4940, 4943, 4946, 4948, 4951, 4954,
	/* 301 ~315 */
    4957, 4960, 4963, 4966, 4969, 4971, 4974, 4977, 4980, 4983, 4986, 4988, 4991, 4994, 4997,
	/* 316 ~330 */
    4999, 5002, 5005, 5008, 5010, 5013, 5016, 5018, 5021, 5024, 5026, 5029, 5032, 5034, 5037,
	/* 331 ~345 */
    5040, 5042, 5045, 5047, 5050, 5053, 5055, 5058, 5060, 5063, 5066, 5068, 5071, 5073, 5076,
	/* 346 ~360 */
    5078, 5081, 5083, 5086, 5088, 5091, 5093, 5096, 5098, 5100, 5103, 5105, 5108, 5110, 5113,
	/* 361 ~375 */
    5115, 5117, 5120, 5122, 5125, 5127, 5129, 5132, 5134, 5136, 5139, 5141, 5143, 5146, 5148,
	/* 376 ~390 */
    5150, 5153, 5155, 5157, 5160, 5162, 5164, 5166, 5169, 5171, 5173, 5175, 5178, 5180, 5182,
	/* 391 ~405 */
    5184, 5187, 5189, 5191, 5193, 5195, 5198, 5200, 5202, 5204, 5206, 5208, 5211, 5213, 5215,
	/* 406 ~420 */
    5217, 5219, 5221, 5223, 5226, 5228, 5230, 5232, 5234, 5236, 5238, 5240, 5242, 5244, 5246,
	/* 421 ~435 */
    5249, 5251, 5253, 5255, 5257, 5259, 5261, 5263, 5265, 5267, 5269, 5271, 5273, 5275, 5277,
	/* 436 ~450 */
    5279, 5281, 5283, 5285, 5287, 5289, 5291, 5293, 5295, 5297, 5299, 5301, 5303, 5304, 5306,
	/* 451 ~465 */
    5308, 5310, 5312, 5314, 5316, 5318, 5320, 5322, 5324, 5326, 5327, 5329, 5331, 5333, 5335,
	/* 466 ~480 */
    5337, 5339, 5340, 5342, 5344, 5346, 5348, 5350, 5352, 5353, 5355, 5357, 5359, 5361, 5362,
	/* 481 ~495 */
    5364, 5366, 5368, 5370, 5371, 5373, 5375, 5377, 5379, 5380, 5382, 5384, 5386, 5387, 5389,
	/* 496 ~510 */
    5391, 5393, 5394, 5396, 5398, 5400, 5401, 5403, 5405, 5407, 5408, 5410, 5412, 5413, 5415,
	/* 511 ~525 */
    5417, 5419, 5420, 5422, 5424, 5425, 5427, 5429, 5430, 5432, 5434, 5435, 5437, 5439, 5440,
	/* 526 ~540 */
    5442, 5444, 5445, 5447, 5449, 5450, 5452, 5453, 5455, 5457, 5458, 5460, 5462, 5463, 5465,
	/* 541 ~555 */
    5466, 5468, 5470, 5471, 5473, 5474, 5476, 5478, 5479, 5481, 5482, 5484, 5485, 5487, 5489,
	/* 556 ~570 */
    5490, 5492, 5493, 5495, 5496, 5498, 5499, 5501, 5503, 5504, 5506, 5507, 5509, 5510, 5512,
	/* 571 ~585 */
    5513, 5515, 5516, 5518, 5519, 5521, 5522, 5524, 5525, 5527, 5528, 5530, 5531, 5533, 5534,
	/* 586 ~600 */
    5536, 5537, 5539, 5540, 5542, 5543, 5545, 5546, 5548, 5549, 5550, 5552, 5553, 5555, 5556,
	/* 601 ~615 */
    5558, 5559, 5561, 5562, 5564, 5565, 5566, 5568, 5569, 5571, 5572, 5574, 5575, 5576, 5578,
	/* 616 ~630 */
    5579, 5581, 5582, 5583, 5585, 5586, 5588, 5589, 5590, 5592, 5593, 5595, 5596, 5597, 5599,
	/* 631 ~645 */
    5600, 5601, 5603, 5604, 5606, 5607, 5608, 5610, 5611, 5612, 5614, 5615, 5616, 5618, 5619,
	/* 646 ~660 */
    5620, 5622, 5623, 5624, 5626, 5627, 5628, 5630, 5631, 5632, 5634, 5635, 5636, 5638, 5639,
	/* 661 ~675 */
    5640, 5642, 5643, 5644, 5646, 5647, 5648, 5650, 5651, 5652, 5653, 5655, 5656, 5657, 5659,
	/* 676 ~690 */
    5660, 5661, 5662, 5664, 5665, 5666, 5668, 5669, 5670, 5671, 5673, 5674, 5675, 5676, 5678,
	/* 691 ~705 */
    5679, 5680, 5681, 5683, 5684, 5685, 5686, 5688, 5689, 5690, 5691, 5693, 5694, 5695, 5696,
	/* 706 ~720 */
    5698, 5699, 5700, 5701, 5703, 5704, 5705, 5706, 5707, 5709, 5710, 5711, 5712, 5713, 5715,
	/* 721 ~735 */
    5716, 5717, 5718, 5719, 5721, 5722, 5723, 5724, 5725, 5727, 5728, 5729, 5730, 5731, 5733,
	/* 736 ~750 */
    5734, 5735, 5736, 5737, 5738, 5740, 5741, 5742, 5743, 5744, 5745, 5747, 5748, 5749, 5750,
	/* 751 ~765 */
    5751, 5752, 5754, 5755, 5756, 5757, 5758, 5759, 5760, 5762, 5763, 5764, 5765, 5766, 5767,
	/* 766 ~780 */
    5768, 5770, 5771, 5772, 5773, 5774, 5775, 5776, 5777, 5779, 5780, 5781, 5782, 5783, 5784,
	/* 781 ~795 */
    5785, 5786, 5788, 5789, 5790, 5791, 5792, 5793, 5794, 5795, 5796, 5797, 5799, 5800, 5801,
	/* 796 ~810 */
    5802, 5803, 5804, 5805, 5806, 5807, 5808, 5809, 5811, 5812, 5813, 5814, 5815, 5816, 5817,
	/* 811 ~825 */
    5818, 5819, 5820, 5821, 5822, 5823, 5824, 5826, 5827, 5828, 5829, 5830, 5831, 5832, 5833,
	/* 826 ~840 */
    5834, 5835, 5836, 5837, 5838, 5839, 5840, 5841, 5842, 5843, 5844, 5845, 5846, 5848, 5849,
	/* 841 ~855 */
    5850, 5851, 5852, 5853, 5854, 5855, 5856, 5857, 5858, 5859, 5860, 5861, 5862, 5863, 5864,
	/* 856 ~870 */
    5865, 5866, 5867, 5868, 5869, 5870, 5871, 5872, 5873, 5874, 5875, 5876, 5877, 5878, 5879,
	/* 871 ~885 */
    5880, 5881, 5882, 5883, 5884, 5885, 5886, 5887, 5888, 5889, 5890, 5891, 5892, 5893, 5894,
	/* 886 ~900 */
    5895, 5896, 5897, 5898, 5899, 5900, 5901, 5902, 5903, 5904, 5905, 5906, 5907, 5908, 5908,
	/* 901 ~915 */
    5909, 5910, 5911, 5912, 5913, 5914, 5915, 5916, 5917, 5918, 5919, 5920, 5921, 5922, 5923,
	/* 916 ~930 */
    5924, 5925, 5926, 5927, 5928, 5929, 5929, 5930, 5931, 5932, 5933, 5934, 5935, 5936, 5937,
	/* 931 ~945 */
    5938, 5939, 5940, 5941, 5942, 5943, 5943, 5944, 5945, 5946, 5947, 5948, 5949, 5950, 5951,
	/* 946 ~960 */
    5952, 5953, 5954, 5955, 5955, 5956, 5957, 5958, 5959, 5960, 5961, 5962, 5963, 5964, 5965,
	/* 961 ~975 */
    5965, 5966, 5967, 5968, 5969, 5970, 5971, 5972, 5973, 5974, 5974, 5975, 5976, 5977, 5978,
	/* 976 ~990 */
    5979, 5980, 5981, 5982, 5982, 5983, 5984, 5985, 5986, 5987, 5988, 5989, 5990, 5990, 5991,
	/* 991~1005 */
    5992, 5993, 5994, 5995, 5996, 5997, 5997, 5998, 5999, 6000, 6001, 6002, 6003, 6003, 6004,
	/* 1006~1020 */
    6005, 6006, 6007, 6008, 6009, 6010, 6010, 6011, 6012, 6013, 6014, 6015, 6015, 6016, 6017,
	/* 1021~1023 */
    6018, 6019, 6020,
};

// 查表计算2000log(input_val)
osal_s32 fe_calc_20log(osal_s32 input_val)
{
    osal_u8 right_shift_bit = 0;
    osal_s32 add_val = 0;
    osal_s32 output = 0;
    osal_s32 shift_val;

    /* 入参32bit数最多移动22次，即可在1024内查表 */
    while (right_shift_bit <= 22) {
        shift_val = oal_rght_shift((osal_s32)get_abs(input_val), right_shift_bit);
        if (shift_val < (sizeof(g_fe_20log_table) / sizeof((g_fe_20log_table)[0]))) {
            output = g_fe_20log_table[shift_val] + add_val;
            break;
        } else {
            add_val += 602; // 20log计算,除2输出加602
            right_shift_bit++;
        }
    }

    /* rf把vdet单端转成双端后,ad转化存在正负值 */
    return ((input_val < 0) ? (-output) : output);
}

// 得到20log计算表的元素个数
osal_u32 fe_20log_table_len(osal_void)
{
    return (sizeof(g_fe_20log_table) / sizeof((g_fe_20log_table)[0]));
}

#ifdef __cplusplus
#if __cplusplus
}
#endif
#endif
